<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/LeetVault.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> LeetVault.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">88.73% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>63/71</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">45.65% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>42/92</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">84.21% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>16/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">88.78% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>87/98</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "@openzeppelin/contracts/utils/Pausable.sol";
&nbsp;
/**
 * @title LeetVault
 * @dev Main vault contract for LeetGaming platform
 * Manages prize pools, entry fees, and prize distribution
 * Blockchain serves as source of truth for all financial state
 */
contract LeetVault is AccessControl, ReentrancyGuard, Pausable {
    using SafeERC20 for IERC20;
&nbsp;
    // Roles
    bytes32 public constant OPERATOR_ROLE = keccak256("OPERATOR_ROLE");
    bytes32 public constant ORACLE_ROLE = keccak256("ORACLE_ROLE");
&nbsp;
    // Supported stablecoins
    mapping(address =&gt; bool) public supportedTokens;
&nbsp;
    // Prize pool states
    enum PrizePoolStatus {
        NotCreated,     // 0
        Accumulating,   // 1 - Accepting entry fees
        Locked,         // 2 - Match in progress
        InEscrow,       // 3 - Match complete, escrow period
        Distributed,    // 4 - Prizes sent
        Cancelled       // 5 - Refunded
    }
&nbsp;
    struct PrizePool {
        bytes32 matchId;
        address token;
        uint256 totalAmount;
        uint256 platformContribution;
        uint256 entryFeePerPlayer;
        uint256 platformFeePercent;  // basis points (100 = 1%)
        uint256 createdAt;
        uint256 lockedAt;
        uint256 escrowEndTime;
        PrizePoolStatus status;
        address[] participants;
        mapping(address =&gt; uint256) contributions;
        mapping(address =&gt; bool) hasWithdrawn;
    }
&nbsp;
    // Match ID =&gt; Prize Pool
    mapping(bytes32 =&gt; PrizePool) public prizePools;
&nbsp;
    // User balances (for withdrawals)
    mapping(address =&gt; mapping(address =&gt; uint256)) public userBalances;
&nbsp;
    // Platform treasury
    address public treasury;
&nbsp;
    // Escrow period (default 72 hours)
    uint256 public escrowPeriod = 72 hours;
&nbsp;
    // Platform contribution per match
    uint256 public platformContributionPerMatch = 50 * 1e4; // $0.50 in 6 decimals
&nbsp;
    // Events
    event TokenAdded(address indexed token);
    event TokenRemoved(address indexed token);
    event PrizePoolCreated(bytes32 indexed matchId, address token, uint256 entryFee, uint256 platformFee);
    event EntryFeeDeposited(bytes32 indexed matchId, address indexed player, uint256 amount);
    event PrizePoolLocked(bytes32 indexed matchId, uint256 totalAmount);
    event PrizePoolInEscrow(bytes32 indexed matchId, uint256 escrowEndTime);
    event PrizeDistributed(bytes32 indexed matchId, address indexed winner, uint256 amount, uint8 rank);
    event PrizePoolCancelled(bytes32 indexed matchId);
    event RefundIssued(bytes32 indexed matchId, address indexed player, uint256 amount);
    event PlatformFeeCollected(bytes32 indexed matchId, uint256 amount);
    event UserWithdrawal(address indexed user, address indexed token, uint256 amount);
    event EscrowPeriodUpdated(uint256 oldPeriod, uint256 newPeriod);
&nbsp;
    constructor(address _treasury) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_treasury != address(0), "Invalid treasury");
        treasury = _treasury;
&nbsp;
        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
        _grantRole(OPERATOR_ROLE, msg.sender);
        _grantRole(ORACLE_ROLE, msg.sender);
    }
&nbsp;
    // ============ Admin Functions ============
&nbsp;
    function addSupportedToken(address token) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(token != address(0), "Invalid token");
        supportedTokens[token] = true;
        emit TokenAdded(token);
    }
&nbsp;
    function removeSupportedToken(address token) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        supportedTokens[token] = false;
        emit TokenRemoved(token);
    }
&nbsp;
    function setEscrowPeriod(uint256 newPeriod) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(newPeriod &gt;= 1 hours &amp;&amp; newPeriod &lt;= 7 days, "Invalid period");
        uint256 oldPeriod = escrowPeriod;
        escrowPeriod = newPeriod;
        emit EscrowPeriodUpdated(oldPeriod, newPeriod);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setTreasury(address newTreasury) external onlyRole(DEFAULT_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(newTreasury != address(0), "Invalid treasury")</span>;
        treasury = newTreasury;
    }
&nbsp;
    function pause() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        _pause();
    }
&nbsp;
    function unpause() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        _unpause();
    }
&nbsp;
    // ============ Prize Pool Management ============
&nbsp;
    /**
     * @dev Create a new prize pool for a match
     * @param matchId Unique match identifier
     * @param token Stablecoin address (USDC/USDT)
     * @param entryFee Entry fee per player (in token decimals)
     * @param platformFeePercent Platform fee in basis points (100 = 1%)
     */
    function createPrizePool(
        bytes32 matchId,
        address token,
        uint256 entryFee,
        uint256 platformFeePercent
    ) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(OPERATOR_ROLE) <span class="missing-if-branch" title="else path not taken" >E</span>whenNotPaused {
        require(supportedTokens[token], "Token not supported");
        require(prizePools[matchId].status == PrizePoolStatus.NotCreated, "Pool exists");
        require(platformFeePercent &lt;= 2000, "Fee too high"); // Max 20%
&nbsp;
        PrizePool storage pool = prizePools[matchId];
        pool.matchId = matchId;
        pool.token = token;
        pool.entryFeePerPlayer = entryFee;
        pool.platformFeePercent = platformFeePercent;
        pool.platformContribution = platformContributionPerMatch;
        pool.createdAt = block.timestamp;
        pool.status = PrizePoolStatus.Accumulating;
&nbsp;
        emit PrizePoolCreated(matchId, token, entryFee, platformFeePercent);
    }
&nbsp;
    /**
     * @dev Player deposits entry fee to join match
     * @param matchId Match to join
     */
    function depositEntryFee(bytes32 matchId) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>whenNotPaused {
        PrizePool storage pool = prizePools[matchId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(pool.status == PrizePoolStatus.Accumulating, "Pool not accepting");
        require(pool.contributions[msg.sender] == 0, "Already joined");
&nbsp;
        IERC20 token = IERC20(pool.token);
        uint256 fee = pool.entryFeePerPlayer;
&nbsp;
        token.safeTransferFrom(msg.sender, address(this), fee);
&nbsp;
        pool.contributions[msg.sender] = fee;
        pool.participants.push(msg.sender);
        pool.totalAmount += fee;
&nbsp;
        emit EntryFeeDeposited(matchId, msg.sender, fee);
    }
&nbsp;
    /**
     * @dev Lock prize pool when match starts (no more entries)
     * @param matchId Match identifier
     */
    function lockPrizePool(bytes32 matchId) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(OPERATOR_ROLE) {
        PrizePool storage pool = prizePools[matchId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(pool.status == PrizePoolStatus.Accumulating, "Invalid status");
        require(pool.participants.length &gt;= 2, "Not enough players");
&nbsp;
        // Add platform contribution
        pool.totalAmount += pool.platformContribution;
        pool.lockedAt = block.timestamp;
        pool.status = PrizePoolStatus.Locked;
&nbsp;
        emit PrizePoolLocked(matchId, pool.totalAmount);
    }
&nbsp;
    /**
     * @dev Move to escrow after match completes (Oracle reports result)
     * @param matchId Match identifier
     */
    function startEscrow(bytes32 matchId) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(ORACLE_ROLE) {
        PrizePool storage pool = prizePools[matchId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(pool.status == PrizePoolStatus.Locked, "Invalid status");
&nbsp;
        pool.escrowEndTime = block.timestamp + escrowPeriod;
        pool.status = PrizePoolStatus.InEscrow;
&nbsp;
        emit PrizePoolInEscrow(matchId, pool.escrowEndTime);
    }
&nbsp;
    /**
     * @dev Distribute prizes to winners after escrow period
     * @param matchId Match identifier
     * @param winners Array of winner addresses (ordered by rank)
     * @param shares Array of share percentages in basis points (must sum to 10000)
     */
    function distributePrizes(
        bytes32 matchId,
        address[] calldata winners,
        uint256[] calldata shares
    ) external onlyRole(OPERATOR_ROLE) <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        PrizePool storage pool = prizePools[matchId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(pool.status == PrizePoolStatus.InEscrow, "Not in escrow");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &gt;= pool.escrowEndTime, "Escrow not complete");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(winners.length == shares.length, "Length mismatch");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(winners.length &gt; 0, "No winners");
&nbsp;
        // Verify shares sum to 10000 (100%)
        uint256 totalShares;
        for (uint256 i = 0; i &lt; shares.length; i++) {
            totalShares += shares[i];
        }
        <span class="missing-if-branch" title="else path not taken" >E</span>require(totalShares == 10000, "Shares must sum to 100%");
&nbsp;
        // Calculate platform fee
        uint256 platformFee = (pool.totalAmount * pool.platformFeePercent) / 10000;
        uint256 distributableAmount = pool.totalAmount - platformFee;
&nbsp;
        // Distribute to winners
        IERC20 token = IERC20(pool.token);
        for (uint256 i = 0; i &lt; winners.length; i++) {
            uint256 prizeAmount = (distributableAmount * shares[i]) / 10000;
            <span class="missing-if-branch" title="else path not taken" >E</span>if (prizeAmount &gt; 0) {
                userBalances[winners[i]][pool.token] += prizeAmount;
                emit PrizeDistributed(matchId, winners[i], prizeAmount, uint8(i + 1));
            }
        }
&nbsp;
        // Send platform fee to treasury
        <span class="missing-if-branch" title="else path not taken" >E</span>if (platformFee &gt; 0) {
            token.safeTransfer(treasury, platformFee);
            emit PlatformFeeCollected(matchId, platformFee);
        }
&nbsp;
        pool.status = PrizePoolStatus.Distributed;
    }
&nbsp;
    /**
     * @dev Cancel prize pool and refund all participants
     * @param matchId Match identifier
     */
    function cancelPrizePool(bytes32 matchId) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(OPERATOR_ROLE) <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        PrizePool storage pool = prizePools[matchId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            pool.status == PrizePoolStatus.Accumulating ||
<span class="branch-1 cbranch-no" title="branch not covered" >            pool.status == PrizePoolStatus.Locked</span>,
            "Cannot cancel"
        );
&nbsp;
        // Refund all participants
        for (uint256 i = 0; i &lt; pool.participants.length; i++) {
            address participant = pool.participants[i];
            uint256 refundAmount = pool.contributions[participant];
            <span class="missing-if-branch" title="else path not taken" >E</span>if (refundAmount &gt; 0 &amp;&amp; !pool.hasWithdrawn[participant]) {
                pool.hasWithdrawn[participant] = true;
                userBalances[participant][pool.token] += refundAmount;
                emit RefundIssued(matchId, participant, refundAmount);
            }
        }
&nbsp;
        pool.status = PrizePoolStatus.Cancelled;
        emit PrizePoolCancelled(matchId);
    }
&nbsp;
    // ============ User Functions ============
&nbsp;
    /**
     * @dev Withdraw user balance to external wallet
     * @param token Token to withdraw
     * @param amount Amount to withdraw
     */
<span class="fstat-no" title="function not covered" >    function withdraw(address token, uint256 amount) external nonReentrant whenNotPaused {</span>
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, "Zero amount")</span>;
<span class="cstat-no" title="statement not covered" >        require(userBalances[msg.sender][token] &gt;= amount, "Insufficient balance")</span>;
&nbsp;
        userBalances[msg.sender][token] -= amount;
<span class="cstat-no" title="statement not covered" >        IERC20(token).safeTransfer(msg.sender, amount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit UserWithdrawal(msg.sender, token, amount);</span>
    }
&nbsp;
    /**
     * @dev Deposit tokens to user balance (for platform use)
     * @param token Token to deposit
     * @param amount Amount to deposit
     */
<span class="fstat-no" title="function not covered" >    function deposit(address token, uint256 amount) external nonReentrant whenNotPaused {</span>
<span class="cstat-no" title="statement not covered" >        require(supportedTokens[token], "Token not supported")</span>;
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, "Zero amount")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        IERC20(token).safeTransferFrom(msg.sender, address(this), amount)</span>;
        userBalances[msg.sender][token] += amount;
    }
&nbsp;
    // ============ View Functions ============
&nbsp;
    function getPrizePoolInfo(bytes32 matchId) external view returns (
        address token,
        uint256 totalAmount,
        uint256 entryFee,
        uint256 platformFee,
        uint256 participantCount,
        PrizePoolStatus status,
        uint256 escrowEndTime
    ) {
        PrizePool storage pool = prizePools[matchId];
        return (
            pool.token,
            pool.totalAmount,
            pool.entryFeePerPlayer,
            pool.platformFeePercent,
            pool.participants.length,
            pool.status,
            pool.escrowEndTime
        );
    }
&nbsp;
    function getParticipants(bytes32 matchId) external view returns (address[] memory) {
        return prizePools[matchId].participants;
    }
&nbsp;
    function getContribution(bytes32 matchId, address participant) external view returns (uint256) {
        return prizePools[matchId].contributions[participant];
    }
&nbsp;
    function getUserBalance(address user, address token) external view returns (uint256) {
        return userBalances[user][token];
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Dec 17 2025 14:43:14 GMT-0300 (Horário Padrão de Brasília)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
